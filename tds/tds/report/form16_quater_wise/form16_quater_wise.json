{
 "add_total_row": 0,
 "add_translate_data": 0,
 "columns": [],
 "creation": "2026-02-08 08:41:51.165988",
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "filters": [],
 "idx": 0,
 "is_standard": "Yes",
 "javascript": "frappe.query_reports[\"Form16 Quater Wise\"] = {\n    filters: [\n        {\n            fieldname: \"company\",\n            label: __(\"Company\"),\n            fieldtype: \"Link\",\n            options: \"Company\",\n        },\n        {\n            fieldname: \"financial_year\",\n            label: __(\"Financial Year\"),\n            fieldtype: \"Link\",\n            options: \"Fiscal Year\",\n        },\n        {\n            fieldname: \"quarter\",\n            label: __(\"Quarter\"),\n            fieldtype: \"Select\",\n            options: [\n                \"Q1 (Apr-Jun)\",\n                \"Q2 (Jul-Sep)\",\n                \"Q3 (Oct-Dec)\",\n                \"Q4 (Jan-Mar)\"\n            ],\n        }\n    ]\n};\n",
 "letterhead": null,
 "modified": "2026-02-08 12:50:48.146892",
 "modified_by": "Administrator",
 "module": "TDS",
 "name": "Form16 Quater Wise",
 "owner": "Administrator",
 "prepared_report": 0,
 "ref_doctype": "Salary Slip",
 "report_name": "Form16 Quater Wise",
 "report_script": "def execute(filters=None):\n    columns = get_columns()\n    data = get_data(filters)\n    return columns, data\n\n\ndef get_columns():\n    return [\n        {\"label\": \"Employee\", \"fieldname\": \"employee\", \"fieldtype\": \"Link\", \"options\": \"Employee\", \"width\": 120},\n        {\"label\": \"Employee Name\", \"fieldname\": \"employee_name\", \"fieldtype\": \"Data\", \"width\": 150},\n        {\"label\": \"PAN\", \"fieldname\": \"pan\", \"fieldtype\": \"Data\", \"width\": 120},\n        {\"label\": \"Quarter\", \"fieldname\": \"quarter\", \"fieldtype\": \"Data\", \"width\": 120},\n        {\"label\": \"Date of Deduction\", \"fieldname\": \"date_of_deduction\", \"fieldtype\": \"Data\", \"width\": 120},\n        {\"label\": \"Total Tax Deducted\", \"fieldname\": \"total_tax\", \"fieldtype\": \"Currency\", \"width\": 150}\n        {\"label\": \"Total Salary\", \"fieldname\": \"total_salary\", \"fieldtype\": \"Data\", \"width\": 120},\n    ]\n\n\ndef get_data(filters):\n    company = filters.get(\"company\")\n    financial_year = filters.get(\"financial_year\")\n    quarter = filters.get(\"quarter\")\n\n    from_date, to_date = get_quarter_dates(financial_year, quarter)\n\n    salary_slips = frappe.db.sql(\"\"\"\n        SELECT\n            ss.employee,\n            ss.employee_name,\n            emp.pan_number,\n            SUM(ss.tax_deducted_tds) AS total_tax\n        FROM `tabSalary Slip` ss\n        INNER JOIN `tabEmployee` emp ON emp.name = ss.employee\n        WHERE\n            ss.company = %s\n            AND ss.start_date >= %s\n            AND ss.end_date <= %s\n            AND ss.docstatus = 1\n        GROUP BY ss.employee\n    \"\"\", (company, from_date, to_date), as_dict=True)\n\n    result = []\n    for row in salary_slips:\n        result.append({\n            \"employee\": row.employee,\n            \"employee_name\": row.employee_name,\n            \"pan\": row.pan_number,\n            \"quarter\": quarter,\n            \"total_tax\": row.total_tax\n        })\n\n    return result\n\n\ndef get_quarter_dates(financial_year, quarter):\n    fy = frappe.get_doc(\"Fiscal Year\", financial_year)\n\n    if quarter == \"Q1 (Apr-Jun)\":\n        return fy.year_start_date, frappe.utils.add_months(fy.year_start_date, 3) - datetime.timedelta(days=1)\n\n    if quarter == \"Q2 (Jul-Sep)\":\n        start = frappe.utils.add_months(fy.year_start_date, 3)\n        return start, frappe.utils.add_months(start, 3) - datetime.timedelta(days=1)\n\n    if quarter == \"Q3 (Oct-Dec)\":\n        start = frappe.utils.add_months(fy.year_start_date, 6)\n        return start, add_months(start, 3) - datetime.timedelta(days=1)\n\n    if quarter == \"Q4 (Jan-Mar)\":\n        start = frappe.utils.add_months(fy.year_start_date, 9)\n        return start, fy.year_end_date",
 "report_type": "Script Report",
 "roles": [
  {
   "role": "HR Manager"
  },
  {
   "role": "Employee"
  },
  {
   "role": "Accountant/Finance Manager/HR"
  },
  {
   "role": "Employee Self Service"
  },
  {
   "role": "Residential Manager"
  },
  {
   "role": "System Manager"
  }
 ],
 "timeout": 0
}